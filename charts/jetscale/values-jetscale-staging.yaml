# ==========================================================
# JETSCALE STACK - DEFAULT INTERFACE
# ==========================================================
global:
  env: "staging"
  # Used for parity with Jetscale-IaC naming conventions and external entrypoints.
  # Example: "jetscale" (live), "pr-123" (ephemeral)
  client_name: "jetscale"
  # tenant_id: ""

# ----------------------------------------------------------
# 1. CORE SERVICES
# ----------------------------------------------------------
backend-api:
  image:
    repository: 081373342681.dkr.ecr.us-east-1.amazonaws.com/jetscale-staging-backend
    tag: staging-jetscale-20260106-233532-d3d4f78
    
backend-ws:
  image:
    repository: 081373342681.dkr.ecr.us-east-1.amazonaws.com/jetscale-staging-backend
    tag: staging-jetscale-20260106-233532-d3d4f78
  
frontend:
  image:
    repository: 081373342681.dkr.ecr.us-east-1.amazonaws.com/jetscale-staging-frontend
    tag: staging-jetscale-20260106-233814-797dbe3

ingress:
  className: alb
  annotations:
    alb.ingress.kubernetes.io/scheme: internet-facing
    alb.ingress.kubernetes.io/target-type: ip
    alb.ingress.kubernetes.io/load-balancer-attributes: idle_timeout.timeout_seconds=3600
    alb.ingress.kubernetes.io/target-group-attributes: stickiness.enabled=true,stickiness.lb_cookie.duration_seconds=60
    alb.ingress.kubernetes.io/listen-ports: '[{"HTTP": 80}, {"HTTPS": 443}]'
    alb.ingress.kubernetes.io/ssl-redirect: '443'
    alb.ingress.kubernetes.io/certificate-arn: arn:aws:acm:us-east-1:081373342681:certificate/ac554daa-f015-41c0-88f6-c41b147d53c6
    alb.ingress.kubernetes.io/conditions.test-encrypted-root: >
      [{"field":"http-header","httpHeaderConfig":{"httpHeaderName": "JetScale-Request-Encryption-Enabled", "values":["true", "True", "TRUE"]}}]
    alb.ingress.kubernetes.io/actions.test-encrypted-root: >
      {"type":"forward","forwardConfig":{"targetGroups":[{"serviceName":"test-backend-api","servicePort":"8000"}]}}
  hosts:
    - host: jetscale.staging.jetscale.ai
      paths:
        # Encrypted requests (highest priority - evaluated first)
        - path: /
          pathType: Prefix
          serviceNameSuffix: encrypted-root
          servicePortName: use-annotation
        # API documentation endpoints
        - path: /openapi.json
          pathType: Prefix
          serviceNameSuffix: backend-api
          servicePortNumber: 8000
        - path: /redoc
          pathType: Prefix
          serviceNameSuffix: backend-api
          servicePortNumber: 8000
        - path: /docs
          pathType: Prefix
          serviceNameSuffix: backend-api
          servicePortNumber: 8000
        # API endpoints (must come before WebSocket for proper matching)
        - path: /api
          pathType: Prefix
          serviceNameSuffix: backend-api
          servicePortNumber: 8000
        # WebSocket endpoints
        - path: /api/v1/ws
          pathType: Prefix
          serviceNameSuffix: backend-ws
          servicePortNumber: 8001
        # Default frontend (lowest priority - catch-all)
        - path: /
          pathType: Prefix
          serviceNameSuffix: frontend
          servicePortNumber: 80
  tls: []
  #  - secretName: chart-example-tls
  #    hosts:
  #      - chart-example.local
