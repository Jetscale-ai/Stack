{{- if .Values.externalSecret.app.enabled }}
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: {{ $.Release.Name }}-app-secrets
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: "{{ .Values.global.client_name }}-secrets-store-{{ .Values.global.env }}"
    kind: SecretStore
  target:
    name: {{ $.Release.Name }}-app-secrets
    creationPolicy: Owner
    deletionPolicy: Delete
    template:
      type: Opaque
  data:
  - secretKey: JETSCALE_ANTHROPIC_API_KEY
    remoteRef:
      key: "{{ .Values.global.client_name }}-{{ .Values.global.env }}/application/config"
      property: anthropic_api_key
  - secretKey: JETSCALE_AWS_ACCESS_KEY_ID
    remoteRef:
      key: "{{ .Values.global.client_name }}-{{ .Values.global.env }}/application/config"
      property: aws_access_key_id
  - secretKey: JETSCALE_AWS_SECRET_ACCESS_KEY
    remoteRef:
      key: "{{ .Values.global.client_name }}-{{ .Values.global.env }}/application/config"
      property: aws_secret_access_key
  - secretKey: JETSCALE_JWT_SECRET_KEY
    remoteRef:
      key: "{{ .Values.global.client_name }}-{{ .Values.global.env }}/application/config"
      property: jwt_secret_key
  - secretKey: JETSCALE_DEFAULT_ADMIN_EMAIL
    remoteRef:
      key: "{{ .Values.global.client_name }}-{{ .Values.global.env }}/application/config"
      property: admin_email
  - secretKey: JETSCALE_DEFAULT_ADMIN_USERNAME
    remoteRef:
      key: "{{ .Values.global.client_name }}-{{ .Values.global.env }}/application/config"
      property: admin_username
  - secretKey: JETSCALE_DEFAULT_ADMIN_PASSWORD
    remoteRef:
      key: "{{ .Values.global.client_name }}-{{ .Values.global.env }}/application/config"
      property: admin_password
  - secretKey: JETSCALE_LANGFUSE_SECRET_KEY
    remoteRef:
      key: "{{ .Values.global.client_name }}-{{ .Values.global.env }}/application/config"
      property: langfuse_secret_key
  - secretKey: JETSCALE_LANGFUSE_PUBLIC_KEY
    remoteRef:
      key: "{{ .Values.global.client_name }}-{{ .Values.global.env }}/application/config"
      property: langfuse_public_key
  - secretKey: JETSCALE_LANGFUSE_HOST
    remoteRef:
      key: "{{ .Values.global.client_name }}-{{ .Values.global.env }}/application/config"
      property: langfuse_host
  - secretKey: JETSCALE_ENABLE_LANGFUSE
    remoteRef:
      key: "{{ .Values.global.client_name }}-{{ .Values.global.env }}/application/config"
      property: enable_langfuse
  - secretKey: JETSCALE_RECOMMENDATION_AGENT_ROLE_ARN
    remoteRef:
      key: "{{ .Values.global.client_name }}-{{ .Values.global.env }}/application/config"
      property: recommendation_agent_role_arn
  - secretKey: JETSCALE_PLANNER_MODEL_NAME
    remoteRef:
      key: "{{ .Values.global.client_name }}-{{ .Values.global.env }}/application/config"
      property: planner_model_name
  - secretKey: JETSCALE_PLANNER_TEMPERATURE
    remoteRef:
      key: "{{ .Values.global.client_name }}-{{ .Values.global.env }}/application/config"
      property: planner_temperature
  - secretKey: JETSCALE_PLANNER_MAX_TOKENS
    remoteRef:
      key: "{{ .Values.global.client_name }}-{{ .Values.global.env }}/application/config"
      property: planner_max_tokens
  - secretKey: JETSCALE_PLANNER_TIMEOUT
    remoteRef:
      key: "{{ .Values.global.client_name }}-{{ .Values.global.env }}/application/config"
      property: planner_timeout
  - secretKey: JETSCALE_PLANNER_DEBUG_MODE
    remoteRef:
      key: "{{ .Values.global.client_name }}-{{ .Values.global.env }}/application/config"
      property: planner_debug_mode
  - secretKey: JETSCALE_RECOMMENDATION_MODEL_NAME
    remoteRef:
      key: "{{ .Values.global.client_name }}-{{ .Values.global.env }}/application/config"
      property: recommendation_model_name
  - secretKey: JETSCALE_RECOMMENDATION_TEMPERATURE
    remoteRef:
      key: "{{ .Values.global.client_name }}-{{ .Values.global.env }}/application/config"
      property: recommendation_temperature

  # Email configuration
  - secretKey: JETSCALE_SMTP_USERNAME
    remoteRef:
      key: "{{ .Values.global.client_name }}-{{ .Values.global.env }}/application/config"
      property: smtp_username
  - secretKey: JETSCALE_SMTP_PASSWORD
    remoteRef:
      key: "{{ .Values.global.client_name }}-{{ .Values.global.env }}/application/config"
      property: smtp_password
  - secretKey: JETSCALE_FRONTEND_URL
    remoteRef:
      key: "{{ .Values.global.client_name }}-{{ .Values.global.env }}/application/config"
      property: frontend_url
  - secretKey: JETSCALE_EMAIL_FROM
    remoteRef:
      key: "{{ .Values.global.client_name }}-{{ .Values.global.env }}/application/config"
      property: email_from
  - secretKey: JETSCALE_EMAIL_FROM_NAME
    remoteRef:
      key: "{{ .Values.global.client_name }}-{{ .Values.global.env }}/application/config"
      property: email_from_name
  - secretKey: JETSCALE_VERIFICATION_TOKEN_EXPIRE_MINUTES
    remoteRef:
      key: "{{ .Values.global.client_name }}-{{ .Values.global.env }}/application/config"
      property: verification_token_expire_minutes
  - secretKey: JETSCALE_MAX_VERIFICATION_ATTEMPTS
    remoteRef:
      key: "{{ .Values.global.client_name }}-{{ .Values.global.env }}/application/config"
      property: max_verification_attempts
  - secretKey: JETSCALE_EMAIL_RATE_LIMIT_PER_HOUR
    remoteRef:
      key: "{{ .Values.global.client_name }}-{{ .Values.global.env }}/application/config"
      property: email_rate_limit_per_hour
  - secretKey: JETSCALE_IP_RATE_LIMIT_PER_HOUR
    remoteRef:
      key: "{{ .Values.global.client_name }}-{{ .Values.global.env }}/application/config"
      property: ip_rate_limit_per_hour
  - secretKey: JETSCALE_VERIFICATION_RATE_LIMIT_PER_HOUR
    remoteRef:
      key: "{{ .Values.global.client_name }}-{{ .Values.global.env }}/application/config"
      property: verification_rate_limit_per_hour
  - secretKey: JETSCALE_ENABLE_ENUMERATION_PROTECTION
    remoteRef:
      key: "{{ .Values.global.client_name }}-{{ .Values.global.env }}/application/config"
      property: enable_enumeration_protection

  # Cron job knobs
  - secretKey: JETSCALE_CRON_API_URL
    remoteRef:
      key: "{{ .Values.global.client_name }}-{{ .Values.global.env }}/application/config"
      property: cron_api_url
  - secretKey: JETSCALE_CRON_REFRESH_DAYS
    remoteRef:
      key: "{{ .Values.global.client_name }}-{{ .Values.global.env }}/application/config"
      property: cron_refresh_days
  - secretKey: JETSCALE_CRON_BATCH_SIZE
    remoteRef:
      key: "{{ .Values.global.client_name }}-{{ .Values.global.env }}/application/config"
      property: cron_batch_size
  - secretKey: JETSCALE_CRON_RETRY_FAILED
    remoteRef:
      key: "{{ .Values.global.client_name }}-{{ .Values.global.env }}/application/config"
      property: cron_retry_failed
  - secretKey: JETSCALE_CRON_ENABLE_ALERTS
    remoteRef:
      key: "{{ .Values.global.client_name }}-{{ .Values.global.env }}/application/config"
      property: cron_enable_alerts
  - secretKey: JETSCALE_CRON_ALERT_ON_ERROR_THRESHOLD
    remoteRef:
      key: "{{ .Values.global.client_name }}-{{ .Values.global.env }}/application/config"
      property: cron_alert_on_error_threshold
{{- end }}
