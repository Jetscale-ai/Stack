{{/*
ServiceAccount for External Secrets (IRSA)

This ServiceAccount is used by SecretStore to authenticate with AWS Secrets Manager.
The IRSA role ARN is provided via values and annotated on the ServiceAccount.

Contract with IaC:
- IaC creates IAM role with wildcard namespace trust: system:serviceaccount:*:*-external-secrets
- Stack creates ServiceAccount with name: {{ .Release.Name }}-external-secrets
*/}}
{{- if .Values.externalSecret.enabled }}
apiVersion: v1
kind: ServiceAccount
metadata:
  name: {{ .Release.Name }}-external-secrets
  labels:
    {{- include "jetscale.labels" . | nindent 4 }}
    app.kubernetes.io/component: external-secrets
  annotations:
    {{- if .Values.externalSecret.irsaRoleArn }}
    eks.amazonaws.com/role-arn: {{ .Values.externalSecret.irsaRoleArn }}
    {{- end }}
{{- end }}
