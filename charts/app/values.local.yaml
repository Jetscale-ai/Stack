# ==========================================================
# LOCAL DEVELOPMENT OVERRIDES
# ==========================================================

global:
  env: "local"

# ----------------------------------------------------------
# 1. DATABASE (Switched to Official Alpine Image)
# ----------------------------------------------------------
postgres:
  enabled: true
  image:
    registry: docker.io
    repository: postgres
    tag: 15-alpine
  auth:
    username: "jetscale-user"
    password: "jetscale-password"
    database: "jetscale"
  primary:
    service:
      ports:
        postgresql: 5432
    persistence:
      enabled: true
      size: 1Gi
      storageClass: "standard"

# ----------------------------------------------------------
# 2. REDIS (Switched to Official Alpine Image)
# ----------------------------------------------------------
redis:
  enabled: true
  image:
    registry: docker.io
    repository: redis
    tag: 7-bullseye
  architecture: standalone
  auth:
    enabled: false

# ----------------------------------------------------------
# 3. BACKEND API (Python / Uvicorn)
# ----------------------------------------------------------
backend-api:
  enabled: true
  replicaCount: 1
  service:
    type: NodePort
    port: 8000
    nodePort: 30000
  devMode:
    enabled: true
    # Host mounts disabled in favor of Tilt Live Update
    # hostPath: "/app/backend"
    # mountPath: "/app"
    command:
      - "python3"
      - "-m"
      - "uvicorn"
      - "main:app"
      - "--host"
      - "0.0.0.0"
      - "--port"
      - "8000"
      - "--reload"
  env:
    JETSCALE_APP_NAME: "JetScale Backend (Local)"
    JETSCALE_DEBUG: "true"
    JETSCALE_DB_NAME: "jetscale"
    JETSCALE_DB_USER: "jetscale-user"
    JETSCALE_DB_PASSWORD: "jetscale-password"
    # Note: Hostname matches the helm release name + chart name
    JETSCALE_DATABASE_URL: "postgresql+asyncpg://jetscale-user:jetscale-password@jetscale-stack-postgres:5432/jetscale"
    JETSCALE_REDIS_URL: "redis://jetscale-stack-redis-master:6379/0"
    JETSCALE_AWS_REGION: "us-east-1"
    PYTHONDONTWRITEBYTECODE: "1"
    PYTHONUNBUFFERED: "1"

# ----------------------------------------------------------
# 4. FRONTEND WEB
# ----------------------------------------------------------
frontend-web:
  enabled: true
  devMode:
    enabled: true
  env:
    VITE_API_BASE_URL: "http://localhost:8000"
