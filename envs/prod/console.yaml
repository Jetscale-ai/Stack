# ==========================================================
# LIVE ENVIRONMENT (EKS) â€” console.jetscale.ai
# ==========================================================
global:
  # Align with Jetscale-IaC `clients/variables/jetscale.tfvars`
  client_name: "jetscale"
  project_name: "console"
  env: "prod"

# ----------------------------------------------------------
# EXTERNAL SECRETS (Shared Cluster Architecture)
# ----------------------------------------------------------
# IaC creates cluster: jetscale-prod and admin secret at jetscale-prod/database/admin.
# Per-project DB credentials: db-bootstrap Job creates DB + secret at
# jetscale-prod/database/{project} (here: jetscale-prod/database/console).
externalSecret:
  enabled: true
  awsRegion: "us-east-1"
  awsSecretPrefix: "jetscale-prod"
  irsaRoleArn: "arn:aws:iam::134051052096:role/jetscale-prod-external-secrets-role"
  db:
    enabled: true
    # bootstrap uses chart default (enabled: true); DB name "console", secret at jetscale-prod/database/console
  redis:
    enabled: true # ElastiCache is provisioned by IaC
    db: 0
  common:
    enabled: true
  app:
    enabled: false # No dynamic app config secret yet
  awsClient:
    # Disabled: AWS client config is now managed via SystemSettings UI
    # See SYSTEM_TODO.md for details on Day 0 vs Day 1 configuration
    enabled: false

# 1. INFRA (Managed by Terraform in AWS)
postgres:
  enabled: false

redis:
  enabled: false

# 2a. BACKEND-API
backend-api:
  enabled: true
  replicaCount: 3
  image:
    repository: ghcr.io/jetscale-ai/backend
    tag: "4.6.12"
  imagePullSecrets:
    - name: ghcr-registry-secret #Created from GH pipeline
  serviceAccount:
    create: true
    name: jetscale-console-api-service-account
    annotations:
      eks.amazonaws.com/role-arn: "arn:aws:iam::134051052096:role/jetscale-prod-app-role"
  # Override envFrom to disable secrets that don't exist
  envFrom:
    config: configMapRef
    db-secret: secretRef
    common-secrets: secretRef
    redis-secret: secretRef
    # Disabled: now configured via SystemSettings UI
    app-secrets: false
  # Production schedule
  cronJobs:
    # NOTE: keys must match `charts/jetscale/values.yaml` to override schedules
    # (otherwise Helm deep-merge creates duplicate CronJobs).
    discover-aws:
      schedule: "0 */4 * * *"
    pull-coh:
      schedule: "30 */6 * * *"
    pull-co:
      schedule: "45 */12 * * *"
      # Remaining cronjobs use chart defaults (suspend: true)

  resources:
    requests:
      cpu: "250m"
      memory: "512Mi"
    limits:
      cpu: "1000m"
      memory: "1Gi"

# 2b. BACKEND-WS
backend-ws:
  enabled: true
  replicaCount: 3
  image:
    repository: ghcr.io/jetscale-ai/backend
    tag: "4.6.12"
  imagePullSecrets:
    - name: ghcr-registry-secret #Created from GH pipeline
  serviceAccount:
    create: true
    name: jetscale-console-ws-service-account
    annotations:
      eks.amazonaws.com/role-arn: "arn:aws:iam::134051052096:role/jetscale-prod-app-role"
  # Override envFrom to disable secrets that don't exist
  envFrom:
    config: configMapRef
    db-secret: secretRef
    common-secrets: secretRef
    redis-secret: secretRef
    # Disabled: now configured via SystemSettings UI
    app-secrets: false
  resources:
    requests:
      cpu: "100m"
      memory: "256Mi"
    limits:
      cpu: "500m"
      memory: "1Gi"

# 3. FRONTEND
frontend:
  enabled: true
  replicaCount: 3
  image:
    repository: ghcr.io/jetscale-ai/frontend
    tag: "2.7.1"
  imagePullSecrets:
    - name: ghcr-registry-secret #Created from GH pipeline
  env:
    # This should point at the same host the Ingress serves for /api
    VITE_API_BASE_URL: "https://console.jetscale.ai"

# 4. ROUTING
ingress:
  enabled: true
  className: "alb"
  annotations:
    alb.ingress.kubernetes.io/certificate-arn: "arn:aws:acm:us-east-1:134051052096:certificate/6e3e7f72-af8e-457d-a397-8f13728dd06c"
    # ExternalDNS (explicit intent)
    external-dns.alpha.kubernetes.io/hostname: "console.jetscale.ai"
  hosts:
    # Explicit empty list: use `envs/aws.yaml` `ingressHostDefaultPaths`
    # (avoids YAML null edge-cases across Helm/YAML versions).
    console.jetscale.ai: []
