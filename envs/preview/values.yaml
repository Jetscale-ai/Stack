# ==========================================================
# PREVIEW ENVIRONMENT (Ephemeral EKS + AWS Infra)
# ==========================================================
global:
  # Overridden by CI (e.g., pr-123)
  env: "preview"
  client_name: "preview" # overwritten by workflow
  tenant_id: "preview"   # overwritten by workflow

# 1. INFRA (Managed by Terraform in AWS)
postgres:
  enabled: false

redis:
  enabled: false

# 2. BACKEND
backend-api:
  enabled: true
  replicaCount: 1
  image:
    repository: ghcr.io/jetscale-ai/backend
    tag: "1.2.3" # Overridden by CI if needed
    pullPolicy: Always
  
  # Prefer Terraform-managed ESO targets (Jetscale-IaC creates these Secrets)
  externalSecrets:
    enabled: false

  # NOTE: Secret names are tenant-specific (e.g., pr-123-db-secret).
  # The workflow injects the correct envFrom refs via `--set`.
  envFrom: []
  
  service:
    type: ClusterIP

  resources:
    requests:
      cpu: "250m"
      memory: "512Mi"

  env:
    JETSCALE_AWS_REGION: "us-east-1"
    # DB/Redis/JWT are injected via envFrom Secrets

# 3. FRONTEND
frontend-web:
  enabled: true
  image:
    repository: ghcr.io/jetscale-ai/frontend
    tag: "2.0.4" # Overridden by CI if needed
  env:
    # The workflow injects the correct host (e.g., https://pr-123.jetscale.ai)
    VITE_API_BASE_URL: "https://preview.jetscale.ai"

# 4. ROUTING
ingress:
  enabled: true
  className: "alb" # Fulfilled by AWS LB Controller
  annotations:
    alb.ingress.kubernetes.io/scheme: internet-facing
    alb.ingress.kubernetes.io/target-type: ip
  hosts:
    - host: "preview.jetscale.ai"
      paths:
        - path: /api
          pathType: Prefix
        - path: /
          pathType: Prefix

apiExternal:
  enabled: true
