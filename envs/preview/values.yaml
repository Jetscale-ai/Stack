# ==========================================================
# PREVIEW ENVIRONMENT (Ephemeral EKS)
# ==========================================================

global:
  env: "preview"

# 1. DATABASE (Ephemeral per PR)
# We keep using the chart dependency for cheap isolation
postgres:
  enabled: true
  primary:
    persistence:
      enabled: false # Ephemeral! Speed up provisioning, no EBS cost.

redis:
  enabled: true
  architecture: standalone

# 2. BACKEND
backend-api:
  enabled: true
  replicaCount: 1
  image:
    # CI will override this with the PR-specific tag
    repository: ghcr.io/jetscale-ai/backend-dev
    tag: "latest"
    pullPolicy: Always
  devMode:
    enabled: false # No hot reload in preview
  service:
    type: ClusterIP # Ingress handles traffic
  resources:
    requests:
      cpu: "250m"
      memory: "512Mi"

# 3. FRONTEND
frontend-web:
  enabled: true
  image:
    repository: ghcr.io/jetscale-ai/frontend-dev
    tag: "latest"

# 4. INGRESS (The Key for Previews)
ingress:
  enabled: true
  className: "alb" # Assuming AWS Load Balancer Controller
  annotations:
    alb.ingress.kubernetes.io/scheme: internet-facing
    alb.ingress.kubernetes.io/target-type: ip
  hosts:
    - host: "preview-placeholder.app.jetscale.ai" # Overridden by CI
      paths:
        - path: /
          pathType: Prefix
